<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <!-- Title and other stuffs -->
  <title>表单页面</title> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="">
  <!-- Stylesheets -->
  <link href="style/bootstrap.css" rel="stylesheet">
  <!-- Font awesome icon -->
  <link rel="stylesheet" href="style/font-awesome.css"> 
  <!-- jQuery UI -->
  <link rel="stylesheet" href="style/jquery-ui.css"> 
  <!-- Calendar -->
  <link rel="stylesheet" href="style/fullcalendar.css">
  <!-- prettyPhoto -->
  <link rel="stylesheet" href="style/prettyPhoto.css">  
  <!-- Star rating -->
  <link rel="stylesheet" href="style/rateit.css">
  <!-- Date picker -->
  <link rel="stylesheet" href="style/bootstrap-datetimepicker.min.css">
  <!-- CLEditor -->
  <link rel="stylesheet" href="style/jquery.cleditor.css"> 
  <!-- Uniform -->
  <link rel="stylesheet" href="style/uniform.default.css"> 
  <!-- Bootstrap toggle -->
  <link rel="stylesheet" href="style/bootstrap-switch.css">
  <!-- Main stylesheet -->
  <link href="style/style.css" rel="stylesheet">
  <!-- Widgets stylesheet -->
  <link href="style/widgets.css" rel="stylesheet">   
  
  <!-- HTML5 Support for IE -->
  <!--[if lt IE 9]>
  <script src="js/html5shim.js"></script>
  <![endif]-->

  <!-- Favicon -->
  <link rel="shortcut icon" href="img/favicon/favicon.png">
<link href="style/lzl.css" rel="stylesheet">
</head>

<body>


<!-- Header starts -->
  <header class="lzlheader">
    <div></div>
  </header>

<!-- Header ends -->

<!-- Main content starts -->

<div class="content">

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-zi"><a href="">后台管理系统</a></div>
        <ul id="nav">
          <li style="display:none" menuName='平台管理维护'><a href="3110.html" class="open">平台管理维护</a></li>
          <li style="display:none" menuName='营运方管理'><a href="3120.html">营运方管理</a></li> 
          <li style="display:none" menuName='持卡人管理'><a href="3130.html">持卡人管理</a></li>
        </ul>
    </div>

    <!-- Sidebar ends -->

  	<!-- Main bar -->
  	<div class="mainbar">
      
	    <!-- Page heading -->
	    <div class="page-head">
        <!-- Page heading -->
	      <h2 class="pull-left">角色权限分配管理
        </h2>


        <!-- Breadcrumb -->
        <div class="bread-crumb pull-right">
          <a href="index.html"><i class="icon-home"></i> 主页</a> 
          <!-- Divider -->
          <span class="divider">/</span> 
          <a href="3110.html" class="bread-current">平台管理维护</a>
          <!-- Divider -->
          <span class="divider">/</span> 
          <a href="qxconfig.html" class="bread-current">角色权限分配管理</a>
        </div>

        <div class="clearfix"></div>

	    </div>
	    <!-- Page heading ends -->



	    <!-- Matter -->

	    <div class="matter">
        <div class="container">

          <div class="row">
             <div id='twoMenus' class="col-md-12" style="text-align:center">

          <a href="3111.html" style="display:none" menuName='平台管理员注册审核' class="btn btn-info">平台管理员注册审核</a>
          <a href="3112.html" style="display:none" menuName='个人信息维护' class="btn btn-info">个人信息维护</a>
          <a href="3113.html" style="display:none" menuName='密码修改'  class="btn btn-info">密码修改</a>
          <a href="3114.html" style="display:none" menuName='平台信息发布' class="btn btn-info">平台信息发布</a>
          <a href="3115.html" style="display:none" menuName='供应方机构' class="btn btn-info">供应方机构</a>
          <a href="qxconfig.html" style="display:none" menuName='角色权限分配' class="btn btn-info"><i class="icon-magic"></i> 角色权限分配</a>
            </div>
          </div> 

          <div class="row">

            <div class="col-md-12">
            
            <div class="widget">

                <div class="widget-head">
                  <div class="pull-left">权限管理</div>
                  
                  <div class="clearfix"></div>
                </div>

                  <div class="widget-content">

                    <table  class="table table-striped table-bordered table-hover">
                      <thead>
                        <tr id='tableHead'>
       	                  
                          <!-- 
                           
                          <th>营运方超级管理员</th>
                          <th>营运方管理员</th>
                          <th>供应方管理员</th>
                          <th>供应方操作员</th>
                          <th>用户</th>
                          -->
                        </tr>
                      </thead>
                        <tbody id='tableData'>
                         <!--
                        
                        <tr>
                          <td>查询用户</td>
                          <td><div class="check-box"><label><input value="check1" type="checkbox"></label></div></td>
                          <td><div class="check-box"><label><input value="check1" type="checkbox"></label></div></td>
                          <td><div class="check-box"><label><input value="check1" type="checkbox"></label></div></td>
                          <td><div class="check-box"><label><input value="check1" type="checkbox"></label></div></td>
                          <td><div class="check-box"><label><input value="check1" type="checkbox"></label></div></td>
                        </tr>
                        -->
                        </tbody>
                    </table>
                    <div class="widget-foot" style="padding-top: 20px;">
                        <div class="neizhong">
                          <button id="setPermission" class="btn btn-success baocun">我已修改完毕并保存</button>
                        </div>

                      
                      <div class="clearfix"></div> 

                    </div>

                  </div>
                </div>
            

            </div>

          </div>






        </div>
		  </div>

		<!-- Matter ends -->

    </div>

   <!-- Mainbar ends -->	    	
   <div class="clearfix"></div>

</div>
<!-- Content ends -->
<div id="ziye-tishixx">

<div class="notification notigreen">
<div class="notiicon"></div>
<div class="notiinfo"><i class="icon-ok-sign"></i><h1></h1><p></p></div>
</div>

<div class="notification notired">
<div class="notiicon"></div>
<div class="notiinfo"><i class="icon-remove-sign"></i><h1></h1><p></p></div>
</div>

<div class="notification notiblue">
<div class="notiicon"></div>
<div class="notiinfo"><i class="icon-exclamation-sign"></i><h1></h1><p></p></div>
</div>

</div>


<!-- Scroll to top -->
<span class="totop"><a href="#"><i class="icon-chevron-up"></i></a></span> 

<div class="suo"></div>
<div class="geren"></div><div class="gerenyin"></div>
<!-- JS -->
<script src="js/jquery.js"></script> <!-- jQuery -->
<script src="js/bootstrap.js"></script> <!-- Bootstrap -->
<script src="js/jquery-ui-1.9.2.custom.min.js"></script> <!-- jQuery UI -->
<script src="js/fullcalendar.min.js"></script> <!-- Full Google Calendar - Calendar -->
<script src="js/jquery.rateit.min.js"></script> <!-- RateIt - Star rating -->
<script src="js/jquery.prettyPhoto.js"></script> <!-- prettyPhoto -->

<!-- jQuery Flot -->
<script src="js/excanvas.min.js"></script>
<script src="js/jquery.flot.js"></script>
<script src="js/jquery.flot.resize.js"></script>
<script src="js/jquery.flot.pie.js"></script>
<script src="js/jquery.flot.stack.js"></script>

<!-- jQuery Notification - Noty -->
<script src="js/jquery.noty.js"></script> <!-- jQuery Notify -->
<script src="js/themes/default.js"></script> <!-- jQuery Notify -->
<script src="js/layouts/bottom.js"></script> <!-- jQuery Notify -->
<script src="js/layouts/topRight.js"></script> <!-- jQuery Notify -->
<script src="js/layouts/top.js"></script> <!-- jQuery Notify -->
<!-- jQuery Notification ends -->

<script src="js/sparklines.js"></script> <!-- Sparklines -->
<script src="js/jquery.cleditor.min.js"></script> <!-- CLEditor -->
<script src="js/bootstrap-datetimepicker.min.js"></script> <!-- Date picker -->
<script src="js/jquery.uniform.min.js"></script> <!-- jQuery Uniform -->
<script src="js/bootstrap-switch.min.js"></script> <!-- Bootstrap Toggle -->
<script src="js/filter.js"></script> <!-- Filter for support page -->
<script src="js/custom.js"></script> <!-- Custom codes -->
<script src="js/charts.js"></script> <!-- Charts & Graphs -->

<script src="js/fun.js"></script>
<script type="text/javascript">

//根据用户菜单隐藏
generalAjax('',"GET","../back/user/findMenus_ro",function(data){
  //隐藏一级菜单
  for ( var key in data.itemList[0]) {
    $('#nav li[menuName="'+key+'"]').css('display','');
  }
  debugger;
  //隐藏二级菜单
  var twoMenus=data.itemList[0]['平台管理维护'];
  for ( var idx in twoMenus) {
    $('#twoMenus a[menuName="'+twoMenus[idx]+'"]').css('display','');
  }
  
});



/**
 * 查询
 */
//默认无条件查询第一页
tiaozhuanPage(1,100,"GET","../sys/role/findRolePermissionState");
//更新table数据
function updateData(list){
	// 角色的个数 5
	debugger;
	var roleCount=4;
	var tableHead=$("#tableHead");
	tableHead.html('');
	tableHead.append('<th>序号</th><th>权限功能列表</th>');
	var tableData=$("#tableData");
	//更新头数据
	for ( var i=0;i<roleCount;i++) {
		tableHead.append('<th>'+list[i].RName+'</th> ');
	}
	//更新行数据
    for(var i=0;i<list.length;i+=roleCount){
    	debugger;
    	var num=(i/roleCount)+1;
     	var tr='<tr><td>'+num+'</td><td>'+list[i].PName+'</td>';
     	for ( var j=i;j<i+roleCount;j++) {
     		var check=list[j].state=='y'?'checked="checked"':'';
     		var td= '<td><div class="check-box"><label>'+
     		'<input PID='+list[j].PID+'  RID='+list[j].RID+'  state='+list[j].state+'  name="rolePermission"'+check+' type="checkbox"></label></div></td>';
    		//tableHead.append('<th>'+list[i].RName+'</th> ');
    		
     		tr+=td;
    	}
	    tr+='<tr>';
    	tableData.append(tr);
    }
}
/**
 * 分配角色权限 
 */
$('#setPermission').unbind().bind('click',function(){
	var checks=  $("input[name=rolePermission]");
	var params='';
	checks.each(function(idx,obj){
		var oldState=$(obj).attr('state');
		var state= obj.checked==true?'y':'n';
		if(state!=oldState){
			var PID= $(obj).attr('PID');
			var RID= $(obj).attr('RID');
			params+=PID+'_'+RID+'_'+state+','
		}
	});
	if(params=='')return;
	params=params.substr(0, params.length-1);
    generalAjax({objs:params},"POST","../sys/role/editRolePermissionState",function(){
       notigreen('操作成功',"分配角色权限成功");
       tiaozhuanPage(currentPage,100,"GET","../sys/role/findRolePermissionState");
    });
});
</script>
</body>
</html>