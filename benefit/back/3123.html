<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <!-- Title and other stuffs -->
  <title>贵州银联权益平台</title> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="">
  <!-- Stylesheets -->
  <link href="style/bootstrap.css" rel="stylesheet">
  <!-- Font awesome icon -->
  <link rel="stylesheet" href="style/font-awesome.css"> 
  <!-- jQuery UI -->
  <link rel="stylesheet" href="style/jquery-ui.css"> 
  <!-- Calendar -->
  <link rel="stylesheet" href="style/fullcalendar.css">
  <!-- prettyPhoto -->
  <link rel="stylesheet" href="style/prettyPhoto.css">  
  <!-- Star rating -->
  <link rel="stylesheet" href="style/rateit.css">
  <!-- Date picker -->
  <link rel="stylesheet" href="style/jquery.datetimepicker.css">
  <!-- CLEditor -->
  <link rel="stylesheet" href="style/jquery.cleditor.css"> 
  <!-- Bootstrap toggle -->
  <link rel="stylesheet" href="style/bootstrap-switch.css">
  <!-- Main stylesheet -->
  <link href="style/style.css" rel="stylesheet">
  <!-- Widgets stylesheet -->
  <link href="style/widgets.css" rel="stylesheet">      
  
  <!-- HTML5 Support for IE -->
  <!--[if lt IE 9]>
  <script src="js/html5shim.js"></script>
  <![endif]-->

  <!-- Favicon -->
  <link rel="shortcut icon" href="img/favicon/favicon.png">
<link href="style/lzl.css" rel="stylesheet">
</head>

<body onload="noading()">


<div class="lzloader">
<div class="progress progress-striped active"><div class="progress-bar progress-bar-default"  role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div></div>
</div>


<!-- Header starts -->
  <header class="lzlheader">
    <div></div>
  </header>

<!-- Header ends -->

<!-- Main content starts -->

<div class="content">

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-zi"><a href="">后台管理系统</a></div>
        <ul id="nav">
          <li style="display:none" menuName='平台管理维护'><a href="3110.html">平台管理维护</a></li>
          <li style="display:none" menuName='营运方管理'><a href="3120.html" class="open">营运方管理</a></li> 
          <li style="display:none" menuName='持卡人管理'><a href="3130.html">持卡人管理</a></li>
          <li style="display:none" menuName='数据统计管理'><a href="3150.html">数据统计管理</a></li>
        </ul>
    </div>

    <!-- Sidebar ends -->

    <!-- Main bar -->
    <div class="mainbar">
      
      <!-- Page heading -->
      <div class="page-head">
        <!-- Page heading -->
        <h2 class="pull-left">权益规则管理
        </h2>


        <!-- Breadcrumb -->
        <div class="bread-crumb pull-right">
          <a href="index.html"><i class="icon-home"></i> 主页</a> 
          <!-- Divider -->
          <span class="divider">/</span> 
          <a href="3120.html" class="bread-current">营运方管理</a>
          <!-- Divider -->
          <span class="divider">/</span> 
          <a href="3123.html" class="bread-current">权益规则管理</a>
        </div>

        <div class="clearfix"></div>

      </div>
      <!-- Page heading ends -->



      <!-- Matter -->

      <div class="matter">
        <div class="container">

          <div class="row" id="bodynav">
            <div id='twoMenus' class="col-md-12" style="text-align:center">
              <a href="3122.html" style="display:none" menuName='服务信息管理' class="btn btn-info">服务信息管理</a>
              <a href="3123.html" style="display:none" menuName='权益规则管理' class="btn btn-info"><i class="icon-magic"></i> 权益规则管理</a>
            </div>
          </div> 

          <div class="row">

            <div class="col-md-12">




            <!-- 查询条件 --> 
        <div class="widget">
            <div class="widget-head">
              <div class="pull-left"></div>
              
              <div class="clearfix"></div>
            </div>
             <div class="widget-content">
               <div class="padd">
                 <form class="form-horizontal" role="form">
               <div class="form-group">
                    <label class="col-lg-4 control-label">权益名称</label>
                    <div class="col-lg-2">
                      <input type="text" class="form-control" id="aaaa" placeholder="输入权益名称" maxlength="16" />
                    </div>
                    

                    <label class="col-lg-4 control-label">服务名称</label>
                    <div class="col-lg-2">
                      <input type="text" class="form-control" id="bbbb" placeholder="输入服务名称" maxlength="16" />
                    </div>

                    <div class="col-lg-2">
                      <a href="#" class="btn btn-primary" id="xxsearch"><i class="icon-search"></i> 查询</a>
                    </div>
                  </div>
                  </form>
                 </div>
               </div>
                  

        </div>


                
            
            <div class="widget">
                <div class="widget-head">
                  <div class="pull-left">权益规则审核</div>
                  <div class="pull-right">
                      <a href="#allshenhetan" class="btn btn-success allshenhe disabled" data-toggle="modal"><i class="icon-ok"></i> 选中项审核</a>
                  </div>
                  <div class="clearfix"></div>
                </div>

                  <div class="widget-content">

                    <table class="table table-striped table-bordered table-hover">
                      <thead>
                        <tr>
                          <th><input class="fugouxuan" type="checkbox" name="" value="" />全选</th>
                          <th>权益名称</th>
                          <th>服务名称</th>
                          <!-- <th>供应方机构</th> -->
                          <th>卡类型</th>
                          <th>数量</th>
                          <th>状态</th>
                          <th>详细操作</th>
                        </tr>
                      </thead>
                      <tbody id='tableData'>
                      </tbody>
                    </table>

                    <div class="widget-foot">
                      
                       <ul class="pager">
                          <li class="previous"><a href="" id="qianBtn"><span aria-hidden="true">&larr;</span> 上一页</a></li>
                          <li id="currentPage">加载中</li>
                          <li id="countPage">加载中</li>
                          <li><input class="form-control" style="width:80px;display:inline;" placeholder="第几页" type="text" id="tiaozhuanPage" name="numonly"></li>
                          <li><button class="btn btn-success" href="" id="tiaozhuanBtn">跳转</button></li>
                          <li class="next"><a href="" id="houBtn">下一页 <span aria-hidden="true">&rarr;</span></a></li>
                        </ul>
                     
                      <div class="clearfix"></div> 

                    </div>

                  </div>

                </div>





            </div>

          </div>

        </div>
      </div>

    <!-- Matter ends -->
    </div>

   <!-- Mainbar ends -->        
   <div class="clearfix"></div>

</div>
<!-- Content ends -->

<!-- Scroll to top -->
<span class="totop"><a href="#"><i class="icon-chevron-up"></i></a></span> 


<!-- Modal -->
<div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-dialog">
  <div class="modal-content">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
      <h4 class="modal-title">权益规则详情</h4>
    </div>
    <div class="modal-body">
    <table class="table table-striped table-bordered table-hover" id="genduotable"></table>
 
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">关闭窗口</button>
    </div>
  </div>
</div>
</div>




<!--*****************************************添加的在这里哦*******************************************************************-->
<div class="cd-popup" role="alert">
    <div class="cd-popup-container">
        <p>您真的要删除这些数据吗?</p>
        <ul class="cd-buttons">
            <li><a href="javascript:void(0)">确定</a></li>
            <li><a href="javascript:void(0)">取消</a></li>
        </ul>
        <a href="" class="cd-popup-close"></a>
    </div> 
</div>

<div id="ziye-tishixx">

<div class="notification notigreen">
<div class="notiicon"></div>
<div class="notiinfo"><i class="icon-ok-sign"></i><h1></h1><p></p></div>
</div>

<div class="notification notired">
<div class="notiicon"></div>
<div class="notiinfo"><i class="icon-remove-sign"></i><h1></h1><p></p></div>
</div>

<div class="notification notiblue">
<div class="notiicon"></div>
<div class="notiinfo"><i class="icon-exclamation-sign"></i><h1></h1><p></p></div>
</div>

</div>

<!-- Modal 审核窗口 -->
    <div id="shenheWin" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                     <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                     <h4 class="modal-title">审核权益规则信息</h4>
                   </div>
                   <div class="modal-body">
                     <button type="button" class="btn btn-success" name='shenhe' val='121' shenheId=''>已通过</button>
                     <button type="button" class="btn btn-danger" name='shenhe' val='122' shenheId=''>未通过</button>
                     <button type="button" class="btn btn-default" name='shenhe' val='123' shenheId=''>停用</button>
                   </div>
                   <div class="modal-footer">
                   <!--  
                     <button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">Close</button>
                     <button type="button" class="btn btn-primary">Save changes</button>
                     -->
                 </div>
               </div>
      </div>
    </div>


<!-- Modal 审核窗口 -->
<div id="allshenhetan" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
                 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                 <h4 class="modal-title">审核选中的权益规则信息</h4>
               </div>
               <div class="modal-body">
                <button type="button" class="btn btn-success" name='allshenhe' val='121' shenheId=''>已通过</button>
                <button type="button" class="btn btn-danger" name='allshenhe' val='122' shenheId=''>未通过</button>
                <button type="button" class="btn btn-default" name='allshenhe' val='123' shenheId=''>停用</button>
               </div>
               <div class="modal-footer">
               <!--  
                 <button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">Close</button>
                 <button type="button" class="btn btn-primary">Save changes</button>
                 -->
             </div>
           </div>
  </div>
</div>
<div class="suo"></div>
<div class="geren"></div><div class="gerenyin"></div>
<!-- JS -->
<script src="js/jquery.js"></script> <!-- jQuery -->
<script src="js/bootstrap.js"></script> <!-- Bootstrap -->
<script src="js/jquery-ui-1.9.2.custom.min.js"></script> <!-- jQuery UI -->
<script src="js/fullcalendar.min.js"></script> <!-- Full Google Calendar - Calendar -->
<script src="js/jquery.rateit.min.js"></script> <!-- RateIt - Star rating -->
<script src="js/jquery.prettyPhoto.js"></script> <!-- prettyPhoto -->

<!-- jQuery Flot -->
<script src="js/excanvas.min.js"></script>
<script src="js/jquery.flot.js"></script>
<script src="js/jquery.flot.resize.js"></script>
<script src="js/jquery.flot.pie.js"></script>
<script src="js/jquery.flot.stack.js"></script>

<!-- jQuery Notification - Noty -->
<script src="js/jquery.noty.js"></script> <!-- jQuery Notify -->
<script src="js/themes/default.js"></script> <!-- jQuery Notify -->
<script src="js/layouts/bottom.js"></script> <!-- jQuery Notify -->
<script src="js/layouts/topRight.js"></script> <!-- jQuery Notify -->
<script src="js/layouts/top.js"></script> <!-- jQuery Notify -->
<!-- jQuery Notification ends -->

<script src="js/sparklines.js"></script> <!-- Sparklines -->
<script src="js/jquery.cleditor.min.js"></script> <!-- CLEditor -->
<script src="js/jquery.datetimepicker.js"></script> <!-- Date picker -->
<script src="js/bootstrap-switch.min.js"></script> <!-- Bootstrap Toggle -->
<script src="js/filter.js"></script> <!-- Filter for support page -->
<script src="js/custom.js"></script> <!-- Custom codes -->
<script src="js/charts.js"></script> <!-- Charts & Graphs -->

<script src="js/fun.js"></script>
<script type="text/javascript">

//根据用户菜单隐藏
generalAjax('',"GET","../back/user/findMenus_ro",function(data){
  //隐藏一级菜单
  for ( var key in data.itemList[0]) {
    $('#nav li[menuName="'+key+'"]').css('display','');
  }
  //隐藏二级菜单
  var twoMenus=data.itemList[0]['营运方管理'];
  for ( var idx in twoMenus) {
    $('#twoMenus a[menuName="'+twoMenus[idx]+'"]').css('display','');
  }
});




 //加载静态权益基本数据数量种类列表
 /*
for(var i=0;i<quanyiCountType.length;i++){
  var  op="<option value='"+quanyiCountType[i][1]+"'>"+quanyiCountType[i][0]+"</option>";
  $("#ff").append(op);
  $("#fff").append(op);
}*/


function bangding(){





}






function genduo(event,obj){

  event.preventDefault();
  var thischeck = $(obj);
  var  tds = thischeck.parent().parent().children('td');
  var gen0 =$(tds.get(3)).text(); 
  var gen1 =$(tds.get(4)).text(); 
  var gen2 =$(tds.get(5)).text(); 
  var gen3 =$(tds.get(6)).text(); 
  var gen4 =$(tds.get(7)).text(); 
  var gen5 =$(tds.get(8)).text();
  var gen6 =$(tds.get(9)).text(); 
  var gen7 =$(tds.get(10)).text();
  var gen8 =$(tds.get(11)).text(); 
  var gen9 =$(tds.get(12)).text();

  gen5=="99999"?gen5="无限":gen5;
  gen6=="99999"?gen6="无限":gen6;

  $("#genduotable").html("");

  var content = "<tbody style=''>";
  content += "<tr><td>权益名称</td><td>"+gen0+"</td></tr>";
  content += "<tr><td>服务名称</td><td>"+gen1+"</td></tr>";
  content += "<tr><td>卡类型</td><td>"+gen2+"</td></tr>";
  content += "<tr><td>数量</td><td>"+gen3+"</td></tr>";
  content += "<tr><td>状态</td><td>"+gen4+"</td></tr>";
  content += "<tr><td>卡每天上限</td><td>"+gen5+" 次</td></tr>";
  content += "<tr><td>卡每天店铺上限</td><td>"+gen6+" 次</td></tr>";
  content += "<tr><td>开始时间</td><td>"+gen7+"</td></tr>";
  content += "<tr><td>结束时间</td><td>"+gen8+"</td></tr>";
  content += "<tr><td>需要金钱</td><td>"+gen9+" 元</td></tr>";

  // if(item.SelfRule1==2){
  //     content += "<tr><td>规则1</td><td>每次都收费</td></tr>";
  // }else if(item.SelfRule1==1){
  //     content += "<tr><td>规则1</td><td>只首次收费</td></tr>";
  // }else if(item.SelfRule1==3){
  //     content += "<tr><td>规则1</td><td>不收费</td></tr>";
  // }else{
  //     content += "<tr><td>规则1</td><td>获取数据出错</td></tr>";
  // }

  // if(item.SelfRule2==1){
  //     content += "<tr><td>规则2</td><td>非62银标卡可使用一次</td></tr>";
  // }else if(item.SelfRule2==0){
  //     content += "<tr><td>规则2</td><td>非62银标卡不可使用</td></tr>";
  // }else{
  //     content += "<tr><td>规则2</td><td>获取数据出错</td></tr>";
  // }

  content += "</tbody>";
  $("#genduotable").append(content);
}








/**
 * 审核
 */
function shenhe(event,obj){
  var thisclick = $(obj);
  var  tds= thisclick.parent().parent().children('td');
  debugger;
  var id =$(tds.get(1)).text(); 
  var id2 = $(tds.get(2)).text(); 
  $("button[name=shenhe]").attr('id',id);
  //审核事件
  $("button[name=shenhe]").unbind().click(function(){
    //请求到后台/OperatorVerify
    var VID=$(this).attr('val');
    var params={objs:id+"_"+id2+"_"+VID};
    generalAjax(params,"POST","../back/rightRule/audit",function(){
      //"审核成功"
       $("#shenheWin").find('.close').click();
       tiaozhuanPage(currentPage,20,"GET","../back/rightRule/findAudit");
    });
  });
}
/**
 * 查询
 */
$("#xxsearch").unbind().bind('click',function(){
  //加入条件
  debugger;
  var xname=$("#aaaa").val();
  var xxname=$("#bbbb").val();
  searchParams= {
    rightName: xname,
    serviceName: xxname,
  };
  tiaozhuanPage(1,20,"GET","../back/rightRule/findAudit");
  return false;
}); 
//默认无条件查询第一页
var searchParams= {
  rightName:"",
  serviceName:"",
};
tiaozhuanPage(1,20,"GET","../back/rightRule/findAudit");

//更新table数据
function updateData(list){
  for(var i=0;i<list.length;i++){
    var obj=list[i];

    var tr= '<tr>'+
          '<td><input class="zigouxuan" type="checkbox" name="" val="" /></td>'+
          '<td style="display:none;">'+obj.RightID+'</td>'+
          '<td style="display:none;">'+obj.CardTypeID+'</td>'+//obj.cardType
          '<td>'+obj.Display+'</td>'+
          '<td>'+obj.serviceName+'</td>'+
          '<td>'+obj.cardType+'</td>'+
          '<td>'+obj.Count+'</td>'+
          '<td>'+obj.VDescription+'</td>'+
          '<td style="display:none;">'+obj.DailyNumTop+'</td>'+
          '<td style="display:none;">'+obj.DailyNumPerStore+'</td>'+
          '<td style="display:none;">'+obj.startDate+'</td>'+
          '<td style="display:none;">'+obj.endDate+'</td>'+
          '<td style="display:none;">'+obj.NeedMoney+'</td>'+
          '<td style="width: 100px;"><a href="#myModal" class="btn btn-xs btn-info genduo" data-toggle="modal"><i class="icon-zoom-in"></i> </a>'+
          '<a style="display:none" href="#shenheWin" class="btn btn-xs btn-success shenhe" data-toggle="modal"><i class="icon-ok"></i></a>'+
          '</td>'+
        ' </tr>';
    $("#tableData").append(tr);
    complete();
  }
  //隐藏不需的功能（增加、删除、修改、审核）
  //addWinBtn deleteBatch auditBatch shenhe xiugai shanchu
  generalAjax({menuName:'权益规则管理'},"GET","../back/user/findPermissionsForMenuName_ro",function(data){
    //隐藏功能按钮
    for ( var idx in data.itemList) {
      var pName=data.itemList[idx]['PName'];
      var pbtn=[];
      if(pName=='批量审核权益规则'){
        pbtn.push($('#auditBatch'));
        pbtn.push($('.shenhe'));
      }
      debugger;
      if(pbtn.length!=0){
        for ( var idx in pbtn) {
          pbtn[idx].css('display','');
        }
      }
    }
  });
  //设置每行数据的操作监听
  $(".shenhe").unbind().bind('click',function(event){
    debugger;
    shenhe(event,this);
  });
  $(".genduo").unbind().bind('click',function(event){
    debugger;
    genduo(event,this);
  });
}







$(".allshenhe").unbind().click(function(event){
event.preventDefault();
var geshu = $("#tableData input:checked").length;
var id = "";
var id2="";
var state ="";
var idall = "";

//alert(chuliidall);

    $("button[name=allshenhe]").unbind().click(function(){
      //请求到后台/OperatorVerify
      loading();
      for(i=0;i<geshu;i++){
      id = $("#tableData input:checked").eq(i).parent().next().text();
      id2 = $("#tableData input:checked").eq(i).parent().next().next().text();
      state = $(this).attr('val');
      idall==""?idall = id + "_" + id2 + "_" + state:idall += "," + id + "_" + id2 + "_" + state;
      }
      var params = {objs:idall};
      generalAjax(params,"POST","../back/rightRule/audit",function(){
        //"修改成功"
         $("#allshenhetan").find('.close').click();
         tiaozhuanPage(currentPage,20,"GET","../back/rightRule/findAudit");
         noading();
      });
    });
});
















function complete(){





$(".fugouxuan").change(function() {

var thisxuan = $(this);
if (thisxuan.is(':checked')) {
    $(".zigouxuan").prop("checked",true);
    thisxuan.parent().parent().parent().parent().children("tbody").children("tr").addClass("warning").addClass("checkgouxuan");;
}
else{
    $(".zigouxuan").prop("checked",false);
    thisxuan.parent().parent().parent().parent().children("tbody").children("tr").removeClass("warning checkgouxuan");
}

$(".checkgouxuan").length > 0?$(".allshenhe").removeClass("disabled"):$(".allshenhe").addClass("disabled");
});


$(".zigouxuan").change(function() {

var thisxuan = $(this);
if (thisxuan.is(':checked')) {
   thisxuan.parent().parent().addClass("warning").addClass("checkgouxuan");
}
else{
    thisxuan.parent().parent().removeClass("warning checkgouxuan");
}

$(".checkgouxuan").length > 0?$(".allshenhe").removeClass("disabled"):$(".allshenhe").addClass("disabled");
});











}
</script>
</body>
</html>